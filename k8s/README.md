# â˜¸ï¸ Kubernetes Infrastructure Architecture

ì´ ë””ë ‰í† ë¦¬ëŠ” ì‡¼í•‘ëª° ì‹œìŠ¤í…œì˜ Kubernetes ë§¤ë‹ˆí˜ìŠ¤íŠ¸ì™€ ì¸í”„ë¼ ì„¤ê³„ êµ¬ì¡°ë¥¼ ë‹´ê³  ìˆìŠµë‹ˆë‹¤. ë³¸ í”„ë¡œì íŠ¸ëŠ” **Hybrid On-premise** êµ¬ì¡°ë¡œ, í´ëŸ¬ìŠ¤í„° ë‚´ë¶€ ì„œë¹„ìŠ¤ì™€ ì™¸ë¶€ ì „ìš© ì„œë²„ê°€ ìœ ê¸°ì ìœ¼ë¡œ ì—°ê²°ë˜ì–´ ìˆìŠµë‹ˆë‹¤.

---

## ğŸ—ï¸ ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜ (System Architecture)

```text
                                     [ External / Public ]
                                               |
                                        (Port: 80, 443)
                                               v
+------------------------------------------------------------------------------------------+
|                                     Bastion Host (172.100.100.3)                         |
|                                  (BIND9 DNS, Nginx Reverse Proxy)                        |
+------------------------------------------------------------------------------------------+
        |                                      |                                     |
        v                                      v                                     v
+-----------------------+              +-----------------------+             +-----------------------+
|  K8s Master (100.4)   |              |  NFS Storage (100.9)  |             |  MySQL Master (100.8) |
|                       |              |                       |             |                       |
|  - Control Plane      | <----------  |  - Product Images     |  <--------  |  - shopping_db        |
|  - MetalLB Controller |  (NFS Mount) |  - MySQL Slave Data   | (Replication)|  - Admin API (Option) |
+-----------------------+              +-----------------------+             +-----------------------+
        |
        +-------------------------------------------------------------+
        |                             |                               |
        v                             v                               v
+-----------------------+     +-----------------------+       +-----------------------+
|  Worker Node 1 (100.5)|     |  Worker Node 2 (100.6)|       |  Worker Node 3 (100.7)|
|                       |     |                       |       |                       |
|  - Ingress Controller |     |  - shop-api Pods      |       |  - frontend Pods      |
|  - MetalLB Speaker    |     |  - mysql-slave Pod    |       |  - metallb-speaker    |
+-----------------------+     +-----------------------+       +-----------------------+
```

---

## ğŸŒ ë„¤íŠ¸ì›Œí¬ êµ¬ì„± (Networking)

### 1. ì „ìš© ë„ë©”ì¸ (Internal DNS)
Bastion ì„œë²„ì˜ BIND9ì„ í†µí•´ í”„ë¡œì íŠ¸ ë‚´ë¶€ ë„ë©”ì¸ì„ ê´€ë¦¬í•©ë‹ˆë‹¤.
- `shop.mall.internal`: í”„ë¡ íŠ¸ì—”ë“œ ì„œë¹„ìŠ¤
- `api.mall.internal`: ì‡¼í•‘ëª° ë°±ì—”ë“œ API
- `admin.mall.internal`: ì „ì²´ ê´€ë¦¬ì API

### 2. ë¶€í•˜ ë¶„ì‚° (LoadBalancer)
- **MetalLB**: ê°€ìƒ IP ëŒ€ì—­(`172.100.100.10 - 100.20`)ì„ ì‚¬ìš©í•˜ì—¬ ì˜¨í”„ë ˆë¯¸ìŠ¤ í™˜ê²½ì—ì„œ `LoadBalancer` íƒ€ì…ì˜ ì„œë¹„ìŠ¤ë¥¼ ì œê³µí•©ë‹ˆë‹¤.
- **NGINX Ingress Controller**: `LoadBalancer`ë¡œë¶€í„° íŠ¸ë˜í”½ì„ ë°›ì•„ ë„ë©”ì¸ ê¸°ë°˜(L7)ìœ¼ë¡œ ê° Namespaceì˜ ì„œë¹„ìŠ¤ë¡œ ë¼ìš°íŒ…í•©ë‹ˆë‹¤.

---

## ğŸ’¾ ë°ì´í„° ë° ì €ì¥ì†Œ (Storage & DB)

### 1. ì˜êµ¬ ì €ì¥ì†Œ (Persistence)
- **NFS Server**: `/mnt/DATA` ê²½ë¡œë¥¼ ì™¸ë¶€ì— ê³µìœ í•©ë‹ˆë‹¤.
- **PV/PVC**: `nfs-client` í”„ë¡œë¹„ì €ë„ˆë¥¼ ì‚¬ìš©í•˜ê±°ë‚˜ ì •ì  PVë¥¼ í†µí•´ `/app/uploads/images` ë° MySQL ë°ì´í„°ë¥¼ ì˜êµ¬ ë³´ê´€í•©ë‹ˆë‹¤.

### 2. ë°ì´í„°ë² ì´ìŠ¤ ë³µì œ (Replication)
- **Master (External)**: ëª¨ë“  ì“°ê¸°(Write) ì‘ì—…ì´ ë°œìƒí•˜ëŠ” ì›ì²œ DBì…ë‹ˆë‹¤.
- **Slave (K8s Inside)**: Masterë¡œë¶€í„° ì‹¤ì‹œê°„ ë³µì œë˜ë©°, ì¡°íšŒ(Read) ë¶€í•˜ ë¶„ì‚° ë° ë°±ì—… ì—­í• ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤.

---

## ğŸ“‚ ë””ë ‰í† ë¦¬ êµ¬ì¡°

- `/base`: í´ëŸ¬ìŠ¤í„° ê³µí†µ ì„¤ì • (Namespace, Ingress, StorageClass ë“±)
- `/apps`: ì• í”Œë¦¬ì¼€ì´ì…˜ ì›Œí¬ë¡œë“œ (Frontend, Shop-API, Admin-API)
- `/mysql`: MySQL Slave ë°°í¬ ë° ì„¤ì • (ConfigMap, Deployment)
- `/templates`: ì„¤ì • ë° ë¹„ë°€ë²ˆí˜¸ í…œí”Œë¦¿

---

## ğŸš€ ì‹œì‘í•˜ê¸°
ìƒì„¸í•œ ì„¤ì¹˜ ë° êµ¬ì¶• ê³¼ì •ì€ [FULL_INSTALLATION.md](../docs/guides/FULL_INSTALLATION.md) ê°€ì´ë“œë¥¼ ì°¸ê³ í•˜ì„¸ìš”.
