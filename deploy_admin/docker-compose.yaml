services:
  nginx:
    image: nginx:alpine
    container_name: admin_nginx
    ports:
      - "80:80"
    volumes:
      - ./nginx/nginx.conf:/etc/nginx/nginx.conf:ro
    depends_on:
      - admin-api
    networks:
      - admin-net
    restart: always

  admin-api:
    image: yongsuchang/shopping-admin-api:test
    container_name: admin_api
    environment:
      - SPRING_PROFILES_ACTIVE=prod
      # 데이터베이스 설정 (Parameter Store에서 가져오지 않는 경우를 대비한 기본값)
      - DB_HOST=172.100.100.8
      - DB_PORT=3306
      - DB_USERNAME=admin_user
      - DB_PASSWORD=password
      
      # AWS Parameter Store 설정
      - AWS_ACCESS_KEY_ID=${AWS_ACCESS_KEY_ID}
      - AWS_SECRET_ACCESS_KEY=${AWS_SECRET_ACCESS_KEY}
      - AWS_REGION=${AWS_REGION}
      # Spring Cloud AWS는 기본적으로 /config/application_name/ 형식을 탐색합니다.
      # 필요 시 SPRING_CONFIG_IMPORT=aws-parameterstore:/your/path/ 추가 가능
    networks:
      - admin-net
    restart: always
    expose:
      - "8081"

networks:
  admin-net:
    driver: bridge